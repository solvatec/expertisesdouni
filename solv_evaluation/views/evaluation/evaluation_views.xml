<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        
        <!-- inherit project form view -->      
        <record id="view_project_project_form_inherit" model="ir.ui.view">
            <field name="name">project.project.form.inherit</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="arch" type="xml">
                <!-- <xpath expr="//sheet" position="before">
                    <header>
                        <field name="stage_id"  widget="statusbar" clickable="True" attrs="{'invisible': [('type_project','!=','evaluation')]}"/>
                    </header>
                </xpath> -->
                
                <xpath expr="//field[@name='name']" position="after">
                    <field name="type_project" invisible="1" readonly="1"/>
                </xpath>
                <xpath expr="//div[@name='options_active']" position="attributes">
                    <attribute name="attrs">{'invisible': [('type_project', 'not in', ('project',False))]}</attribute>
                </xpath>
                <xpath expr="//button[@name='476']" position="attributes">
                    <attribute name="attrs">{'invisible': [('type_project', 'not in', ('project',False))]}</attribute>
                </xpath>                
            </field>
        </record>

        <record id="view_evaluation_form" model="ir.ui.view">
            <field name="name">evaluation.form</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="priority" eval="8"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="after">
                    <field name="stage_id" invisible="1"/> 
                    <field name="create_uid" invisible="1"/> 
                </xpath>
                <xpath expr="//div[@name='options_active']" position="after">
                    <group attrs="{'invisible': [('type_project', 'in', ('project','sinistre',False))]}">
                        <group>
                            <!-- <field name="num_dossier"/> -->
                            <field name="partner_site_id" string="Adresse du site"/> 
                            <field name="partner_id" string="Groupe/ Société Mére"/>
                            <field name="partner_interm_id"/> 
                            <field name="urgent"/>                            
                            <field name="nature_mission"/> 
                            <field name="nature_dossier" string="DI ou MAJ ?"/>
                            <field name="type_maj" attrs="{'invisible': [('nature_dossier', '=', 'dossier_initial')]}"/> 
                            <field name="num_maj" attrs="{'invisible': [('nature_dossier', '=', 'dossier_initial')]}"/> 
                        </group>
                        <group>
                            <field name="state"/>
                            <field name="date_order"/>
                            <field name="date_due"/>
                            <field name="date_order_end"/>
                            <field name="date_order_cancel"/>
                            <field name="state_order"/> 
                            <field name="scan_3d"/> 
                        </group>
                    </group>
                </xpath> 
                <xpath expr="//page[@name='settings']" position="attributes">
                    <attribute name="attrs">{'invisible': [('type_project', 'not in', ('project','sinistre',False))]}</attribute>
                </xpath>
                <xpath expr="//page[@name='description_page']" position="before">
                    <page string="Collaborateurs" attrs="{'invisible': [('type_project', 'in', ('project','sinistre',False))]}">
                        <field name="partner_ids">
                            <tree string="Collaborateurs" editable="bottom">
                                <field name="name"/>
                                <field name="collaborator_id"/>
                            </tree>
                        </field> 
                        <div class="oe_chatter">
                            <field name="message_follower_ids" widget="mail_followers" options="{'post_refresh':True}" groups="base.group_user"/>
                            <field name="activity_ids" widget="mail_activity"/>
                            <field name="message_ids" widget="mail_thread"/>
                        </div>                   
                    </page>
                    <!-- <page string="Dates de la Commande" attrs="{'invisible': [('type_project', 'in', ('project','sinistre',False))]}">
                        <group>
                            <group>
                                
                            </group>
                            <group>
                                
                            </group>
                        </group>                   
                    </page -->
                    <page string="Dates de la Commande" attrs="{'invisible': [('type_project', 'in', ('project','sinistre',False))]}">
                        <group>
                            <group>
                                <field name="date_expert_assign"/>
                                <field name="date_intervention"/>
                                <field name="date_visite_end"/>
                                <field name="date_rprt_start"/>
                                <field name="date_rprt_end"/>
                                <field name="date_remise_saisie"/>
                                <field name="date_saisie_start"/>
                            </group>
                            <group>
                                <field name="date_saisie_end"/>
                                <field name="date_rprt_validate"/>
                                <field name="date_rprt_validated"/>
                                <field name="date_montage"/>
                                <field name="date_remise_invoice"/>
                                <field name="date_invoice_send"/>
                            </group>
                        </group>                   
                    </page>
                    <page string="Contacts de la Commande" attrs="{'invisible': [('type_project', 'in', ('project','sinistre',False))]}">
                        <group>
                            <group>
                                <field name="partner_order_id"/>
                                <field name="partner_principal_id"/>
                            </group>
                            <group>
                                <field name="partner_on_site_id"/>
                                <field name="partner_report_id"/>
                            </group>
                        </group>                   
                    </page>
                    <page string="Fichiers" attrs="{'invisible': [('type_project', 'in', ('project','sinistre',False))]}">
                        <group>
                            <group>
                                <field name="evaluation_report_doc_ids" widget="many2many_binary"/>
                            </group> 
                            <group>
                                <field name="evaluation_doc_ids" widget="many2many_binary"/>
                            </group> 
                        </group>              
                    </page>
                    <page string="SCAN 3D" attrs="{'invisible': ['|', ('type_project', 'in', ('project','sinistre',False)), ('scan_3d', '=', False)]}">
                        <group>
                            <field name="scan_3d_embed_doc_ids" widget="many2many_binary"/>
                        </group>              
                    </page>
                    <page string="Facturation et Frais" attrs="{'invisible': [('type_project', 'in', ('project','sinistre',False))]}">
                        <group>
                            <group>
                                <field name="is_invoice"/>
                                <field name="invoice_state"/>
                                <field name="amount_invoice"/>
                                <field name="amount_frais"/>
                            </group> 
                            <group>
                                <field name="commission_expert"/>
                                <field name="commission_assistate"/>
                                <field name="commission_partner"/>
                            </group> 
                        </group>             
                    </page>
                    <page string="Modifications" attrs="{'invisible': [('type_project', 'in', ('project','sinistre',False))]}">
                        <group>
                            <group>
                                <field name="date_update"/>
                            </group> 
                            <group>
                                <field name="update_state" string="État Modifications"/>
                            </group> 
                            <field name="update"/>
                        </group>             
                    </page>
                </xpath> 
            </field>
        </record>

        <!-- inherit project kanban view -->      
        <record id="view_evaluation_kanban" model="ir.ui.view">
            <field name="name">project.project.kanban.inherit</field>
            <field name="inherit_id" ref="project.view_project_kanban"/>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <xpath expr="//kanban" position="replace">
                    <!-- on_create="project.open_create_project" -->
                    <kanban default_group_by="stage_id" class="oe_background_grey o_kanban_dashboard o_project_kanban o_emphasize_colors" sample="1">
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="color"/>
                    <field name="task_count"/>
                    <field name="label_tasks"/>
                    <field name="alias_id"/>
                    <field name="alias_name"/>
                    <field name="alias_domain"/>
                    <field name="is_favorite"/>
                    <field name="rating_percentage_satisfaction"/>
                    <field name="rating_status"/>
                    <field name="rating_active"/>
                    <field name="analytic_account_id"/>
                    <field name="activity_ids"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="#{kanban_color(record.color.raw_value)} oe_kanban_global_click o_has_icon">
                                <div class="o_project_kanban_main">
                                    <div class="o_kanban_card_content">
                                        <div class="o_kanban_primary_left">
                                            <div class="o_primary">
                                                <span><t t-esc="record.name.value"/></span>
                                                <span t-if="record.partner_id.value">
                                                    <strong><t t-esc="record.partner_id.value"/></strong>
                                                </span>
                                            </div>
                                            <div t-if="record.alias_name.value and record.alias_domain.value">
                                                <span><i class="fa fa-envelope" role="img" aria-label="Domain Alias" title="Domain Alias"/> <a t-att-href="'mailto:' + record.alias_id.value" title="Send an email"><t t-esc="record.alias_id.value"/></a></span>
                                            </div>
                                            <div t-if="record.rating_active.raw_value" class="mt8 text-primary" title="Percentage of happy ratings over the past 30 days." groups="project.group_project_rating">
                                                <b>
                                                    <a name="action_view_all_rating" type="object" context="{'search_default_rating_last_30_days':1}">
                                                        <t t-if="record.rating_percentage_satisfaction.value != -1">
                                                            <i class="fa fa-smile-o" role="img" aria-label="Percentage of satisfaction" title="Percentage of satisfaction"/> <t t-esc="record.rating_percentage_satisfaction.value"/>%
                                                        </t>
                                                    </a>
                                                </b>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="o_kanban_card_manage_pane dropdown-menu" groups="project.group_project_manager" role="menu">
                                        <div class="o_kanban_card_manage_section o_kanban_manage_reports">
                                            <div role="menuitem">
                                                <a name="164" type="action">Partager</a>
                                            </div>
                                            <div role="menuitem">
                                                <a type="edit">Modifier</a>
                                            </div>
                                        </div>
                                        <div role="menuitem" aria-haspopup="true" class="o_no_padding_kanban_colorpicker">
                                            <ul class="oe_kanban_colorpicker" data-field="color" role="popup"/>
                                        </div>
                                    </div>
                                    <a class="o_kanban_manage_toggle_button o_left" href="#" groups="project.group_project_manager"><i class="fa fa-ellipsis-v" role="img" aria-label="Manage" title="Manage"/></a>
                                    <span class="o_right"><field name="is_favorite" widget="boolean_favorite" nolabel="1" force_save="1"/></span>
                                </div>

                                <div class="o_project_kanban_boxes">
                                    <!-- <a class="o_project_kanban_box" name="action_view_tasks" type="object">
                                        <div>
                                            <span class="o_value"><t t-esc="record.task_count.value"/></span>
                                            <span class="o_label"><t t-esc="record.label_tasks.value"/></span>
                                        </div>
                                    </a> -->
                                    <a t-if="record.analytic_account_id.raw_value" class="o_project_kanban_box o_project_timesheet_box" name="action_view_account_analytic_line" type="object" groups="analytic.group_analytic_accounting">
                                        <div>
                                            <span class="o_label">Rentabilité</span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
                </xpath>
            </field>
        </record>

        <!-- inherit project tree view -->      
        <record id="view_evaluation_tree" model="ir.ui.view">
            <field name="name">project.project.tree.inherit</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <tree decoration-muted="active == False" string="Projects" delete="0" multi_edit="1" sample="1">
                    <field name="sequence" optional="show" widget="handle"/>
                    <field name="message_needaction" invisible="1"/>
                    <field name="active" invisible="1"/>
                    <field name="name" string="Name" class="font-weight-bold"/>
                    <field name="user_id" optional="show" string="Project Manager" widget="many2one_avatar_user"/>
                    <field name="partner_id" optional="show" string="Client"/>
                    <!-- <field name="activity_ids" widget="list_activity" optional="show"/> -->
                    <field name="analytic_account_id" optional="hide"/>
                    <field name="privacy_visibility" optional="hide"/>
                    <field name="subtask_project_id" optional="hide"/>
                    <field name="label_tasks" optional="hide"/>
                    <field name="company_id" optional="show" groups="base.group_multi_company"/>
                </tree>
            </field>
        </record>

        <!-- <record model="ir.actions.act_window.view" id="act_evaluation_view_form">
            <field name="act_window_id" ref="act_project_project_evaluation"/>
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_evaluation_form"/>
        </record>

        <record model="ir.actions.act_window.view" id="act_evaluation_view_tree">
            <field name="act_window_id" ref="act_project_project_evaluation"/>
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_evaluation_tree"/>
        </record>

        <record model="ir.actions.act_window.view" id="act_evaluation_view_kanban">
            <field name="act_window_id" ref="act_project_project_evaluation"/>
            <field name="sequence" eval="5"/>
            <field name="view_mode">kanban</field>
            <field name="view_id" ref="view_evaluation_kanban"/>
        </record> -->

        <record model="ir.actions.act_window" id="act_project_project_evaluation">
            <field name="name">Evaluation</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">project.project</field>
            <field name="view_mode">kanban,tree,form,activity</field>
            <field name="domain">[('type_project','=','evaluation')]</field>
            <field name="context">{'default_type_project': 'evaluation'}</field>
        </record>

        <!-- Activity types config -->
        <!-- <record id="mail_activity_type_action_config_project_evaluation_types" model="ir.actions.act_window">
            <field name="name">Types d'activities</field>
            <field name="res_model">mail.activity.type</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">['|', ('res_model_id', '=', False), ('res_model_id.model', '=', 'project.project')]</field>
            <field name="context">{'default_res_model': 'project.project'}</field>
        </record> -->
        
    </data>
</odoo>